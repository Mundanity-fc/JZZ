!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("JZZ",[],e):t.JZZ=e()}(this,function(){var t,e,n,i,r="0.4.4";function o(){this._orig=this,this._ready=!1,this._queue=[],this._err=[]}function s(t,e){setTimeout(function(){t._resume()},e)}function u(t){t instanceof Function?t.apply(this):console.log(t)}function a(t){t instanceof Function?t.apply(this):console.log(t)}function c(t){this._break("closed"),t._resume()}function h(t){if(t.length){var e=t.shift();if(t.length){var n=this;this._slip(a,[function(){h.apply(n,[t])}])}try{this._repair(),e.apply(this)}catch(t){this._break(t.toString())}}else this._break()}function f(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return;t.push(e)}function p(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return void t.splice(n,1)}function l(){o.apply(this)}function _(){l.prototype._time||(l.prototype._time=function(){return Date.now()}),l.prototype._startTime=l.prototype._time(),l.prototype.time=function(){return l.prototype._time()-l.prototype._startTime}}function d(t,e,n){if(void 0===e)return d(t,[],[]);if(t instanceof Object){for(var i=0;i<e.length;i++)if(e[i]===t)return n[i];var r;r=t instanceof Array?[]:{},e.push(t),n.push(r);for(var o in t)t.hasOwnProperty(o)&&(r[o]=d(t[o],e,n));return r}return t}o.prototype._exec=function(){for(;this._ready&&this._queue.length;){var t=this._queue.shift();this._orig._bad?this._orig._hope&&t[0]==a?(this._orig._hope=!1,t[0].apply(this,t[1])):(this._queue=[],this._orig._hope=!1):t[0]!=a&&t[0].apply(this,t[1])}},o.prototype._push=function(t,e){this._queue.push([t,e]),o.prototype._exec.apply(this)},o.prototype._slip=function(t,e){this._queue.unshift([t,e])},o.prototype._pause=function(){this._ready=!1},o.prototype._resume=function(){this._ready=!0,o.prototype._exec.apply(this)},o.prototype._break=function(t){this._orig._bad=!0,this._orig._hope=!0,t&&this._orig._err.push(t)},o.prototype._repair=function(){this._orig._bad=!1},o.prototype._crash=function(t){this._break(t),this._resume()},o.prototype.err=function(){return d(this._err)},o.prototype.wait=function(t){if(!t)return this;var e=function(){};e.prototype=this._orig;var n=new e;return n._ready=!1,n._queue=[],this._push(s,[n,t]),n},o.prototype.and=function(t){return this._push(u,[t]),this},o.prototype.or=function(t){return this._push(a,[t]),this},o.prototype._info={},o.prototype.info=function(){var t=d(this._orig._info);return void 0===t.engine&&(t.engine="none"),void 0===t.sysex&&(t.sysex=!0),t},o.prototype.name=function(){return this.info().name},o.prototype.close=function(){var t=new o;return this._close&&this._push(this._close,[]),this._push(c,[t]),t},l.prototype=new o,l.prototype.time=function(){return 0},"undefined"!=typeof performance&&performance.now&&(l.prototype._time=function(){return performance.now()}),l.prototype._info={name:"JZZ.js",ver:r,version:r};var m,g=[],v=[];function y(){var t,e;for(this._info.engine=k._type,this._info.version=k._version,this._info.sysex=k._sysex,this._info.inputs=[],this._info.outputs=[],g=[],v=[],k._allOuts={},k._allIns={},t=0;t<k._outs.length;t++)(e=k._outs[t]).engine=k,k._allOuts[e.name]=e,this._info.outputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:k._type}),g.push(e);for(t=0;t<D._outs.length;t++)e=D._outs[t],this._info.outputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),g.push(e);for(t=0;t<k._ins.length;t++)(e=k._ins[t]).engine=k,k._allIns[e.name]=e,this._info.inputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:k._type}),v.push(e);for(t=0;t<D._ins.length;t++)e=D._ins[t],this._info.inputs.push({name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),v.push(e)}function S(){this._slip(y,[]),k._refresh()}function M(t,e){if(void 0===t)return e.slice();var n,i,r=[];if(t instanceof RegExp){for(i=0;i<e.length;i++)t.test(e[i].name)&&r.push(e[i]);return r}for(t instanceof Function&&(t=t(e)),t instanceof Array||(t=[t]),n=0;n<t.length;n++)for(i=0;i<e.length;i++)(t[n]+""==i+""||t[n]===e[i].name||t[n]instanceof Object&&t[n].name===e[i].name)&&r.push(e[i]);return r}function w(t,e){var n;n=e instanceof RegExp?"Port matching "+e+" not found":e instanceof Object||void 0===e?"Port not found":'Port "'+e+'" not found',t._crash(n)}function E(t,e){var n=M(e,g);if(n.length){for(var i=function(t){return function(){t.engine._openOut(this,t.name)}},r=0;r<n.length;r++)n[r]=i(n[r]);t._slip(h,[n]),t._resume()}else w(t,e)}function I(t,e){var n=M(e,v);if(n.length){for(var i=function(t){return function(){t.engine._openIn(this,t.name)}},r=0;r<n.length;r++)n[r]=i(n[r]);t._slip(h,[n]),t._resume()}else w(t,e)}function C(t){this._orig._watcher._slip(L,[t]),this._orig._watcher._resume()}function O(){o.apply(this),this._handles=[],this._outs=[]}function b(t){this._receive(t)}function B(t){this._emit(t)}function x(t){t instanceof Function?f(this._orig._handles,t):f(this._orig._outs,t)}function A(t){void 0===t?(this._orig._handles=[],this._orig._outs=[]):t instanceof Function?p(this._orig._handles,t):p(this._orig._outs,t)}function P(){o.apply(this),this._handles=[]}function L(t){t instanceof Function&&(this._orig._handles.length||k._watch(),f(this._orig._handles,t))}function q(t){void 0===t?this._orig._handles=[]:p(this._orig._handles,t),this._orig._handles.length||k._unwatch()}function F(t,e,n,i){if(function(t,e,n,i){var r;if(t.length!=n.length||e.length!=i.length)return!0;for(r=0;r<t.length;r++)if(t[r].name!=n[r].name)return!0;for(r=0;r<e.length;r++)if(e[r].name!=i[r].name)return!0;return!1}(t,e,n,i)){var r,o=[],s=[],u=[],a=[],c={};for(r=0;r<t.length;r++)c[t[r].name]=!0;for(r=0;r<n.length;r++)c[n[r].name]||o.push(n[r]);for(c={},r=0;r<n.length;r++)c[n[r].name]=!0;for(r=0;r<t.length;r++)c[t[r].name]||u.push(t[r]);for(c={},r=0;r<e.length;r++)c[e[r].name]=!0;for(r=0;r<i.length;r++)c[i[r].name]||s.push(i[r]);for(c={},r=0;r<i.length;r++)c[i[r].name]=!0;for(r=0;r<e.length;r++)c[e[r].name]||a.push(e[r]);return o.length||u.length||s.length||a.length?{inputs:{added:o,removed:u},outputs:{added:s,removed:a}}:void 0}}function z(e){for(t=0;t<m._watcher._handles.length;t++)m._watcher._handles[t].apply(m,[e])}l.prototype.refresh=function(){return this._push(S,[]),this},l.prototype.openMidiOut=function(t){var e=new O;return this._push(S,[]),this._push(E,[e,t]),e},l.prototype.openMidiIn=function(t){var e=new O;return this._push(S,[]),this._push(I,[e,t]),e},l.prototype.onChange=function(t){return this._orig._watcher||(this._orig._watcher=new P),this._push(C,[t]),this._orig._watcher},l.prototype._close=function(){k._close()},O.prototype=new o,O.prototype._receive=function(t){this._emit(t)},O.prototype.send=function(){return this._push(b,[$.apply(null,arguments)]),this},O.prototype.note=function(t,e,n,i){return this.noteOn(t,e,n),i&&this.wait(i).noteOff(t,e),this},O.prototype._emit=function(t){var e;for(e=0;e<this._handles.length;e++)this._handles[e].apply(this,[$(t)._stamp(this)]);for(e=0;e<this._outs.length;e++){var n=$(t);n._stamped(this._outs[e])||this._outs[e].send(n._stamp(this))}},O.prototype.emit=function(t){return this._push(B,[t]),this},O.prototype.connect=function(t){return this._push(x,[t]),this},O.prototype.disconnect=function(t){return this._push(A,[t]),this},P.prototype=new o,P.prototype.connect=function(t){return this._push(L,[t]),this},P.prototype.disconnect=function(t){return this._push(q,[t]),this};var k={},D={_outs:[],_ins:[]};function T(){if("undefined"!=typeof module&&module.exports)return t=require("jazz-midi"),k._type="node",k._main=t,k._pool=[],k._newPlugin=function(){return new t.MIDI},void J();var t;this._break()}function j(){var t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);var e,n=document.createElement("object");if(n.style.visibility="hidden",n.style.width="0px",n.style.height="0px",n.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",n.type="audio/x-jazz",document.body.appendChild(n),n.isJazz)return e=n,k._type="plugin",k._main=e,k._pool=[e],k._newPlugin=function(){var t=document.createElement("object");return t.style.visibility="hidden",t.style.width="0px",e.style.height="0px",t.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",t.type="audio/x-jazz",document.body.appendChild(t),t.isJazz?t:void 0},void J();this._break()}function N(){if(navigator.requestMIDIAccess){var t=this;return navigator.requestMIDIAccess({}).then(function(e){Q(e),t._resume()},function(e){t._crash(e)}),void this._pause()}this._break()}function R(){if(navigator.requestMIDIAccess){var t=this;return navigator.requestMIDIAccess({sysex:!0}).then(function(e){Q(e,!0),t._resume()},function(e){t._crash(e)}),void this._pause()}this._break()}function G(){var t,e,n=this;this._pause(),document.addEventListener("jazz-midi-msg",function i(r){if(t=!0,e||(e=document.getElementById("jazz-midi-msg")),e){var o,s,u,a,c,h=[];try{h=JSON.parse(e.innerText)}catch(t){}e.innerText="",document.removeEventListener("jazz-midi-msg",i),"version"===h[0]?(o=e,s=h[2],k._type="extension",k._version=s,k._sysex=!0,k._pool=[],k._inArr=[],k._outArr=[],k._inMap={},k._outMap={},k._msg=o,k._newPlugin=function(){var t={id:k._pool.length};t.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):t.ready=!0,k._pool.push(t)},k._newPlugin(),k._refresh=function(){k._outs=[],k._ins=[],m._pause(),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},_closeAll=function(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])},k._openOut=function(t,e){var n=k._outMap[e];if(!n){k._pool.length<=k._outArr.length&&k._newPlugin();var i=k._pool[k._outArr.length];(n={name:e,clients:[],info:{name:e,manufacturer:k._allOuts[e].manufacturer,version:k._allOuts[e].version,type:"MIDI-out",sysex:k._sysex,engine:k._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",i.id,e]}))},_close:function(t){k._closeOut(t)},_closeAll:_closeAll,_receive:function(t){var e=t.slice();e.splice(0,0,"play",i.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:e}))}}).plugin=i,i.output=n,k._outArr.push(n),k._outMap[e]=n}t._orig._impl=n,f(n.clients,t._orig),t._info=n.info,t._receive=function(t){n._receive(t)},t._close=function(){n._close(this)},n.open||(n.plugin.ready&&n._start(),t._pause())},k._openIn=function(t,e){var n=k._inMap[e];if(!n){k._pool.length<=k._inArr.length&&k._newPlugin();var i=k._pool[k._inArr.length];(n={name:e,clients:[],info:{name:e,manufacturer:k._allIns[e].manufacturer,version:k._allIns[e].version,type:"MIDI-in",sysex:k._sysex,engine:k._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",i.id,e]}))},_close:function(t){k._closeIn(t)},_closeAll:_closeAll}).plugin=i,i.input=n,k._inArr.push(n),k._inMap[e]=n}t._orig._impl=n,f(n.clients,t._orig),t._info=n.info,t._close=function(){n._close(this)},n.open||(n.plugin.ready&&n._start(),t._pause())},k._closeOut=function(t){var e=t._impl;p(e.clients,t._orig),e.clients.length||(e.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",e.plugin.id]})))},k._closeIn=function(t){var e=t._impl;p(e.clients,t._orig),e.clients.length||(e.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",e.plugin.id]})))},k._close=function(){},k._watch=function(){a=k._ins,c=k._outs,u=setInterval(function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))},250)},k._unwatch=function(){clearInterval(u),u=void 0},document.addEventListener("jazz-midi-msg",function(t){var e,n,i,r=k._msg.innerText.split("\n");for(k._msg.innerText="",n=0;n<r.length;n++){var o=[];try{o=JSON.parse(r[n])}catch(t){}if(o.length)if("refresh"===o[0]){if(o[1].ins){for(i=0;i<o[1].ins.length;i++)o[1].ins[i].type=k._type;k._ins=o[1].ins}if(o[1].outs){for(i=0;i<o[1].outs.length;i++)o[1].outs[i].type=k._type;k._outs=o[1].outs}if(m._resume(),u){var s=F(a,c,k._ins,k._outs);if(s){for(a=k._ins,c=k._outs,i=0;i<s.inputs.removed.length;i++)(e=k._inMap[s.inputs.removed[i].name])&&e._closeAll();for(i=0;i<s.outputs.removed.length;i++)(e=k._outMap[s.inputs.removed[i].name])&&e._closeAll();z(s)}}}else if("version"===o[0]){var h=k._pool[o[1]];h&&(h.ready=!0,h.input&&h.input._start(),h.output&&h.output._start())}else if("openout"===o[0]){if(e=k._pool[o[1]].output)if(o[2]==e.name){if(e.open=!0,e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._resume()}else if(e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._crash()}else if("openin"===o[0]){if(e=k._pool[o[1]].input)if(o[2]==e.name){if(e.open=!0,e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._resume()}else if(e.clients)for(i=0;i<e.clients.length;i++)e.clients[i]._crash()}else if("midi"===o[0]&&(e=k._pool[o[1]].input)&&e.clients)for(i=0;i<e.clients.length;i++){var f=$(o.slice(3));e.clients[i]._emit(f)}}}),n._resume()):n._crash()}});try{document.dispatchEvent(new Event("jazz-midi"))}catch(t){}window.setTimeout(function(){t||n._crash()},0)}function V(){this._pause();var t=this;setTimeout(function(){t._crash()},0)}function W(t){for(var e=[T,V],n=function(t){var e=["extension","webmidi","plugin"];if(!t||!t.engine)return e;for(var n,i,r=t.engine instanceof Array?t.engine:[t.engine],o={},s=[],u=[],a=0;a<r.length;a++){var c=r[a].toString().toLowerCase();o[c]||(o[c]=!0,"none"===c&&(n=!0),"etc"===c&&(i=!0),i?u.push(c):s.push(c),p(e,c))}(i||s.length||u.length)&&(n=!1);return n?[]:s.concat(i?e:u)}(t),i=0;i<n.length;i++)"webmidi"==n[i]?(t&&!0===t.sysex&&e.push(R),t&&!0===t.sysex&&!0!==t.degrade||e.push(N)):"extension"==n[i]?e.push(G):"plugin"==n[i]&&e.push(j);return e.push(H),e}function H(){k._type="none",k._sysex=!0,k._refresh=function(){k._outs=[],k._ins=[]}}function J(){k._inArr=[],k._outArr=[],k._inMap={},k._outMap={},k._version=k._main.version,k._sysex=!0,k._refresh=function(){var t,e;for(k._outs=[],k._ins=[],t=0;(e=k._main.MidiOutInfo(t)).length;t++)k._outs.push({type:k._type,name:e[0],manufacturer:e[1],version:e[2]});for(t=0;(e=k._main.MidiInInfo(t)).length;t++)k._ins.push({type:k._type,name:e[0],manufacturer:e[1],version:e[2]})},k._openOut=function(t,e){var n=k._outMap[e];if(!n){k._pool.length<=k._outArr.length&&k._pool.push(k._newPlugin()),n={name:e,clients:[],info:{name:e,manufacturer:k._allOuts[e].manufacturer,version:k._allOuts[e].version,type:"MIDI-out",sysex:k._sysex,engine:k._type},_close:function(t){k._closeOut(t)},_receive:function(t){this.plugin.MidiOutRaw(t.slice())}};var i=k._pool[k._outArr.length];n.plugin=i,k._outArr.push(n),k._outMap[e]=n}if(!n.open){var r=n.plugin.MidiOutOpen(e);if(r!==e)return r&&n.plugin.MidiOutClose(),void t._break();n.open=!0}t._orig._impl=n,f(n.clients,t._orig),t._info=n.info,t._receive=function(t){n._receive(t)},t._close=function(){n._close(this)}},k._openIn=function(t,e){var n,i=k._inMap[e];if(!i){k._pool.length<=k._inArr.length&&k._pool.push(k._newPlugin());(i={name:e,clients:[],info:{name:e,manufacturer:k._allIns[e].manufacturer,version:k._allIns[e].version,type:"MIDI-in",sysex:k._sysex,engine:k._type},_close:function(t){k._closeIn(t)},handle:function(t,e){for(var n=0;n<this.clients.length;n++){var i=$(e);this.clients[n]._emit(i)}}}).onmidi=(n=i,function(t,e){n.handle(t,e)});var r=k._pool[k._inArr.length];i.plugin=r,k._inArr.push(i),k._inMap[e]=i}if(!i.open){var o=i.plugin.MidiInOpen(e,i.onmidi);if(o!==e)return o&&i.plugin.MidiInClose(),void t._break();i.open=!0}t._orig._impl=i,f(i.clients,t._orig),t._info=i.info,t._close=function(){i._close(this)}},k._closeOut=function(t){var e=t._impl;p(e.clients,t._orig),e.clients.length||(e.open=!1,e.plugin.MidiOutClose())},k._closeIn=function(t){var e=t._impl;p(e.clients,t._orig),e.clients.length||(e.open=!1,e.plugin.MidiInClose())},k._close=function(){for(var t=0;t<k._inArr.length;t++)k._inArr[t].open&&k._inArr[t].plugin.MidiInClose()},l.prototype._time=function(){return k._main.Time()}}function Q(t,e){k._type="webmidi",k._version=43,k._sysex=!!e,k._access=t,k._inMap={},k._outMap={},k._refresh=function(){k._outs=[],k._ins=[],k._access.outputs.forEach(function(t,e){k._outs.push({type:k._type,name:t.name,manufacturer:t.manufacturer,version:t.version})}),k._access.inputs.forEach(function(t,e){k._ins.push({type:k._type,name:t.name,manufacturer:t.manufacturer,version:t.version})})},k._openOut=function(t,e){var n=k._outMap[e];n||(n={name:e,clients:[],info:{name:e,manufacturer:k._allOuts[e].manufacturer,version:k._allOuts[e].version,type:"MIDI-out",sysex:k._sysex,engine:k._type},_close:function(t){k._closeOut(t)},_receive:function(t){this.dev.send(t.slice())}},k._access.outputs.forEach(function(t,i){t.name===e&&(n.dev=t)}),n.dev?k._outMap[e]=n:n=void 0);n?(n.dev.open&&n.dev.open(),t._orig._impl=n,f(n.clients,t._orig),t._info=n.info,t._receive=function(t){n._receive(t)},t._close=function(){n._close(this)}):t._break()},k._openIn=function(t,e){var n,i=k._inMap[e];if(!i)if(i={name:e,clients:[],info:{name:e,manufacturer:k._allIns[e].manufacturer,version:k._allIns[e].version,type:"MIDI-in",sysex:k._sysex,engine:k._type},_close:function(t){k._closeIn(t)},handle:function(t){for(var e=0;e<this.clients.length;e++){var n=$([].slice.call(t.data));this.clients[e]._emit(n)}}},k._access.inputs.forEach(function(t,n){t.name===e&&(i.dev=t)}),i.dev){i.dev.onmidimessage=(n=i,function(t){n.handle(t)}),k._inMap[e]=i}else i=void 0;i?(i.dev.open&&i.dev.open(),t._orig._impl=i,f(i.clients,t._orig),t._info=i.info,t._close=function(){i._close(this)}):t._break()},k._closeOut=function(t){var e=t._impl;e.clients.length||e.dev.close&&e.dev.close(),p(e.clients,t._orig)},k._closeIn=function(t){var e=t._impl;p(e.clients,t._orig),e.clients.length||e.dev.close&&e.dev.close()},k._close=function(){}}var Z=function(t){var e;return m||(e=t,(m=new l)._options=e,m._push(h,[W(e)]),m.refresh(),m._push(_,[]),m._push(function(){g.length||v.length||this._break()},[]),m._resume()),m};function U(){var t=this instanceof U?this:t=new U;return U.prototype.reset.apply(t,arguments),t}function K(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function X(t){return[[24,25,29.97,30][t[7]>>1&3],(1&t[7])<<4|t[6],t[5]<<4|t[4],t[3]<<4|t[2],t[1]<<4|t[0]]}function Y(t){return t<10?"0"+t:t}function $(e){var n=this instanceof $?this:n=new $;if(n._from=e instanceof $?e._from.slice():[],!arguments.length)return n;var r=e instanceof Array?e:arguments;for(t=0;t<r.length;t++)i=r[t],1==t&&n[0]>=128&&n[0]<=175&&(i=$.noteValue(i)),(i!=parseInt(i)||i<0||i>255)&&nt(r[t]),n.push(i);return n}Z.info=function(){return l.prototype.info()},Z.Widget=function(t){var e=new O;if(t instanceof Object)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e._resume(),e},l.prototype.Widget=Z.Widget,Z.createNew=Z.Widget,l.prototype.createNew=Z.Widget,U.prototype.reset=function(t){if(t instanceof U)return this.setType(t.getType()),this.setHour(t.getHour()),this.setMinute(t.getMinute()),this.setSecond(t.getSecond()),this.setFrame(t.getFrame()),this.setQuarter(t.getQuarter()),this;var e=t instanceof Array?t:arguments;return this.setType(e[0]),this.setHour(e[1]),this.setMinute(e[2]),this.setSecond(e[3]),this.setFrame(e[4]),this.setQuarter(e[5]),this},U.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},U.prototype.getType=function(){return this.type},U.prototype.getHour=function(){return this.hour},U.prototype.getMinute=function(){return this.minute},U.prototype.getSecond=function(){return this.second},U.prototype.getFrame=function(){return this.frame},U.prototype.getQuarter=function(){return this.quarter},U.prototype.setType=function(t){if(void 0===t||24==t)this.type=24;else if(25==t)this.type=25;else if(29.97==t)this.type=29.97,K.apply(this);else{if(30!=t)throw RangeError("Bad SMPTE frame rate: "+t);this.type=30}return this.frame>=this.type&&(this.frame=29.97==this.type?29:this.type-1),this},U.prototype.setHour=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=24)throw RangeError("Bad SMPTE hours value: "+t);return this.hour=t,this},U.prototype.setMinute=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE minutes value: "+t);return this.minute=t,K.apply(this),this},U.prototype.setSecond=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE seconds value: "+t);return this.second=t,K.apply(this),this},U.prototype.setFrame=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=this.type)throw RangeError("Bad SMPTE frame number: "+t);return this.frame=t,K.apply(this),this},U.prototype.setQuarter=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=8)throw RangeError("Bad SMPTE quarter frame: "+t);return this.quarter=t,this},U.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,this.second>=60&&(this.second=0,this.minute++,this.minute>=60&&(this.minute=0,this.hour=this.hour>=23?0:this.hour+1))),K.apply(this),this},U.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},U.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,0!=this.quarter&&4!=this.quarter||this.incrFrame(),this},U.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,3!=this.quarter&&7!=this.quarter||this.decrFrame(),this},U.prototype.read=function(t){if(t instanceof $||(t=$.apply(null,arguments)),240==t[0]&&127==t[1]&&1==t[3]&&1==t[4]&&247==t[9])return this.type=[24,25,29.97,30][t[5]>>5&3],this.hour=31&t[5],this.minute=t[6],this.second=t[7],this.frame=t[8],this.quarter=0,this._=void 0,this._b=void 0,this._f=void 0,!0;if(241==t[0]&&void 0!==t[1]){var e=t[1]>>4,n=15&t[1];return 0==e?7==this._&&(7==this._f&&(this.reset(X(this._a)),this.incrFrame()),this.incrFrame()):3==e?4==this._&&this.decrFrame():4==e?3==this._&&this.incrFrame():7==e&&0===this._&&(0===this._b&&(this.reset(X(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[e]=n,this._f=this._f===e-1||0==e?e:void 0,this._b=this._b===e+1||7==e?e:void 0,this._=e,this.quarter=e,!0}return!1},U.prototype.toString=function(){return[Y(this.hour),Y(this.minute),Y(this.second),Y(this.frame)].join(":")},Z.SMPTE=U,$.prototype=[],$.prototype.constructor=$;var tt={};$.noteValue=function(t){return tt[t.toString().toLowerCase()]},$.programValue=function(t){return t};var et={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(e in et)if(et.hasOwnProperty(e))for(i=0;i<12&&!((n=et[e]+12*i)>127);i++)tt[e+i]=n,n>0&&(tt[e+"b"+i]=n-1,tt[e+"bb"+i]=n-2),n<127&&(tt[e+"#"+i]=n+1,tt[e+"##"+i]=n+2);for(i=0;i<128;i++)tt[i]=i;function nt(t){throw RangeError("Bad MIDI value: "+t)}function it(t){return(t!=parseInt(t)||t<0||t>15)&&nt(t),t}function rt(t){return(t!=parseInt(t)||t<0||t>127)&&nt(t),t}function ot(t){return(t!=parseInt(t)||t<0||t>16383)&&nt(t),127&t}function st(t){return(t!=parseInt(t)||t<0||t>16383)&&nt(t),t>>7}var ut={noteOff:function(t,e){return[128+it(t),rt($.noteValue(e)),0]},noteOn:function(t,e,n){return[144+it(t),rt($.noteValue(e)),rt(n)]},aftertouch:function(t,e,n){return[160+it(t),rt($.noteValue(e)),rt(n)]},control:function(t,e,n){return[176+it(t),rt(e),rt(n)]},program:function(t,e){return[192+it(t),rt($.programValue(e))]},pressure:function(t,e){return[208+it(t),rt(e)]},pitchBend:function(t,e){return[224+it(t),ot(e),st(e)]},bankMSB:function(t,e){return[176+it(t),0,rt(e)]},bankLSB:function(t,e){return[176+it(t),32,rt(e)]},modMSB:function(t,e){return[176+it(t),1,rt(e)]},modLSB:function(t,e){return[176+it(t),33,rt(e)]},breathMSB:function(t,e){return[176+it(t),2,rt(e)]},breathLSB:function(t,e){return[176+it(t),34,rt(e)]},footMSB:function(t,e){return[176+it(t),4,rt(e)]},footLSB:function(t,e){return[176+it(t),36,rt(e)]},portamentoMSB:function(t,e){return[176+it(t),5,rt(e)]},portamentoLSB:function(t,e){return[176+it(t),37,rt(e)]},volumeMSB:function(t,e){return[176+it(t),7,rt(e)]},volumeLSB:function(t,e){return[176+it(t),39,rt(e)]},balanceMSB:function(t,e){return[176+it(t),8,rt(e)]},balanceLSB:function(t,e){return[176+it(t),40,rt(e)]},panMSB:function(t,e){return[176+it(t),10,rt(e)]},panLSB:function(t,e){return[176+it(t),42,rt(e)]},expressionMSB:function(t,e){return[176+it(t),11,rt(e)]},expressionLSB:function(t,e){return[176+it(t),43,rt(e)]},damper:function(t,e){return[176+it(t),64,e?127:0]},portamento:function(t,e){return[176+it(t),65,e?127:0]},sostenuto:function(t,e){return[176+it(t),66,e?127:0]},soft:function(t,e){return[176+it(t),67,e?127:0]},allSoundOff:function(t){return[176+it(t),120,0]},allNotesOff:function(t){return[176+it(t),123,0]},mtc:function(t){return[241,function(t){var e;switch(!t.backwards&&t.quarter>=4?t.decrFrame():t.backwards&&t.quarter<4&&t.incrFrame(),t.quarter>>1){case 0:e=t.frame;break;case 1:e=t.second;break;case 2:e=t.minute;break;default:e=t.hour}return 1&t.quarter?e>>=4:e&=15,7==t.quarter&&(25==t.type?e|=2:29.97==t.type?e|=4:30==t.type&&(e|=6)),!t.backwards&&t.quarter>=4?t.incrFrame():t.backwards&&t.quarter<4&&t.decrFrame(),e|t.quarter<<4}(t)]},songPosition:function(t){return[242,ot(t),st(t)]},songSelect:function(t){return[243,rt(t)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},continue:function(){return[251]},stop:function(){return[252]},active:function(){return[254]},sxIdRequest:function(){return[240,126,127,6,1,247]},sxFullFrame:function(t){return[240,127,127,1,1,(e=t,25==e.type?32|e.hour:29.97==e.type?64|e.hour:30==e.type?96|e.hour:e.hour),t.getMinute(),t.getSecond(),t.getFrame(),247];var e},reset:function(){return[255]}};function at(t,e){$[t]=function(){return new $(e.apply(0,arguments))},O.prototype[t]=function(){return this.send(e.apply(0,arguments)),this}}for(e in ut)ut.hasOwnProperty(e)&&at(e,ut[e]);var ct,ht={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};for(e=0;e<16;e++)ht[e]=e;if($.prototype.getChannel=function(){var t=this[0];if(!(void 0===t||t<128||t>239))return 15&t},$.prototype.setChannel=function(t){var e=this[0];return void 0===e||e<128||e>239?this:(void 0!==(t=ht[t])&&(this[0]=240&e|t),this)},$.prototype.getNote=function(){var t=this[0];if(!(void 0===t||t<128||t>175))return this[1]},$.prototype.setNote=function(t){var e=this[0];return void 0===e||e<128||e>175?this:(void 0!==(t=$.noteValue(t))&&(this[1]=t),this)},$.prototype.getVelocity=function(){var t=this[0];if(!(void 0===t||t<144||t>159))return this[2]},$.prototype.setVelocity=function(t){var e=this[0];return void 0===e||e<144||e>159?this:((t=parseInt(t))>=0&&t<128&&(this[2]=t),this)},$.prototype.getSysExChannel=function(){if(240==this[0])return this[2]},$.prototype.setSysExChannel=function(t){return 240==this[0]&&this.length>2&&(t=parseInt(t))>=0&&t<128&&(this[2]=t),this},$.prototype.isNoteOn=function(){var t=this[0];return!(void 0===t||t<144||t>159)&&this[2]>0},$.prototype.isNoteOff=function(){var t=this[0];return!(void 0===t||t<128||t>159)&&(t<144||0==this[2])},$.prototype.isSysEx=function(){return 240==this[0]},$.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},$.prototype.toString=function(){if(!this.length)return"empty";var t=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=(t[n]<16?"0":"")+t[n].toString(16);return e.join(" ")}(this);if(this[0]<128)return t;var e={241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"}[this[0]];if(e)return t+" -- "+e;var n=this[0]>>4;return(e={8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"}[n])?t+" -- "+e:9==n?t+" -- "+(this[2]?"Note On":"Note Off"):11!=n?t:((e={0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal On/Off",65:"Portamento On/Off",66:"Sostenuto On/Off",67:"Soft Pedal On/Off",68:"Legato Footswitch",69:"Hold 2",70:"Sound Controller 1",71:"Sound Controller 2",72:"Sound Controller 3",73:"Sound Controller 4",74:"Sound Controller 5",75:"Sound Controller 6",76:"Sound Controller 7",77:"Sound Controller 8",78:"Sound Controller 9",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"}[this[1]])||(e="Undefined"),t+" -- "+e)},$.prototype._stamp=function(t){return this._from.push(t._orig?t._orig:t),this},$.prototype._unstamp=function(t){if(void 0===t)this._from=[];else{t._orig&&(t=t._orig);var e=this._from.indexOf(t);e>-1&&this._from.splice(e,1)}return this},$.prototype._stamped=function(t){t._orig&&(t=t._orig);for(var e=0;e<this._from.length;e++)if(this._from[e]==t)return!0;return!1},Z.MIDI=$,(Z.lib={}).openMidiOut=function(t,e){var n=new O;return e._openOut(n,t),n},Z.lib.openMidiIn=function(t,e){var n=new O;return e._openIn(n,t),n},Z.lib.registerMidiOut=function(t,e){for(var n=e._info(t),i=0;i<D._outs.length;i++)if(D._outs[i].name==n.name)return!1;return n.engine=e,D._outs.push(n),m&&m._bad&&(m._repair(),m._resume()),!0},Z.lib.registerMidiIn=function(t,e){for(var n=e._info(t),i=0;i<D._ins.length;i++)if(D._ins[i].name==n.name)return!1;return n.engine=e,D._ins.push(n),m&&m._bad&&(m._repair(),m._resume()),!0},Z.lib.getAudioContext=function(){return ct},"undefined"!=typeof window){var ft=window.AudioContext||window.webkitAudioContext;ft&&(ct=new ft),ct&&!ct.createGain&&(ct.createGain=ct.createGainNode);var pt=function(){if("running"!=ct.state){ct.resume();var t=ct.createOscillator(),e=ct.createGain();e.gain.setTargetAtTime(0,ct.currentTime,.01),t.connect(e),e.connect(ct.destination),t.start||(t.start=t.noteOn),t.stop||(t.stop=t.noteOff),t.start(.1),t.stop(.11)}else document.removeEventListener("touchend",pt),document.removeEventListener("mousedown",pt),document.removeEventListener("keydown",pt)};document.addEventListener("touchend",pt),document.addEventListener("mousedown",pt),document.addEventListener("keydown",pt),pt()}return Z});